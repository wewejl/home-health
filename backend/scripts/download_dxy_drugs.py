#!/usr/bin/env python3
"""
ä¸é¦™å›­è¯å“æ•°æ®å¹¶å‘ä¸‹è½½å™¨
ä½¿ç”¨ asyncio + httpx å¹¶å‘è·å–è¯å“æ•°æ®å¹¶ä¿å­˜ä¸º JSON
"""
import asyncio
import json
import time
from pathlib import Path
from typing import Dict, List, Any
import httpx

# å¸¸è§è¯å“åˆ—è¡¨ï¼ˆæŒ‰ç±»åˆ«åˆ†ç±»ï¼‰
COMMON_DRUGS = {
    "æ„Ÿå†’å‘çƒ§": "é˜¿å¸åŒ¹æ—,å¸ƒæ´›èŠ¬,å¯¹ä¹™é…°æ°¨åŸºé…š,åŒæ°¯èŠ¬é…¸é’ ,å¡æ¥æ˜”å¸ƒ,æ´›ç´¢æ´›èŠ¬,å²å“šç¾è¾›,å¥ˆæ™®ç”Ÿ,ä¾æ‰˜è€ƒæ˜”,ç¾æ´›æ˜”åº·,å¡ç½—æ˜”åº·,æ°¯è¯ºæ˜”åº·,å¸•ç‘æ˜”å¸ƒ",
    "æŠ—ç”Ÿç´ ": "å¤´å­¢æ‹‰å®š,å¤´å­¢å…‹è‚Ÿ,å¤´å­¢å‘‹è¾›,å¤´å­¢åœ°å°¼,å¤´å­¢ä¸™çƒ¯,å¤´å­¢æ°¨è‹„,é˜¿è«è¥¿æ—,é˜¿è«è¥¿æ—å…‹æ‹‰ç»´é…¸é’¾,é˜¿å¥‡éœ‰ç´ ,å…‹æ‹‰éœ‰ç´ ,ç½—çº¢éœ‰ç´ ,å·¦æ°§æ°Ÿæ²™æ˜Ÿ,è«è¥¿æ²™æ˜Ÿ,ç¯ä¸™æ²™æ˜Ÿ,åŠ æ›¿æ²™æ˜Ÿ,å¤šè¥¿ç¯ç´ ,ç±³è¯ºç¯ç´ ,å…‹æ—éœ‰ç´ ,ç£·éœ‰ç´ ",
    "é™å‹è¯": "æ°¨æ°¯åœ°å¹³,è‹¯ç£ºé…¸æ°¨æ°¯åœ°å¹³,ç¡è‹¯åœ°å¹³,éæ´›åœ°å¹³,å„è´æ²™å¦,ç¼¬æ²™å¦,æ›¿ç±³æ²™å¦,æ°¯æ²™å¦é’¾,ç¾æ‰˜æ´›å°”,é…’çŸ³é…¸ç¾æ‰˜æ´›å°”,æ¯”ç´¢æ´›å°”,å¯Œé©¬é…¸æ¯”ç´¢æ´›å°”,å¡æ‰˜æ™®åˆ©,ä¾é‚£æ™®åˆ©,åŸ¹å“šæ™®åˆ©,è´é‚£æ™®åˆ©,é›·ç±³æ™®åˆ©,ç¦è¾›æ™®åˆ©,å„è´æ²™å¦æ°¢æ°¯å™»å—ª,ç¼¬æ²™å¦æ°¢æ°¯å™»å—ª,æ›¿ç±³æ²™å¦æ°¢æ°¯å™»å—ª,ä¹Œæ‹‰åœ°å°”,æ‹‰è´æ´›å°”,ç»´æ‹‰å¸•ç±³,åœ°å°”ç¡«ä“¬,éæ´›åœ°å¹³,ä¹å¡åœ°å¹³",
    "é™è„‚è¯": "é˜¿æ‰˜ä¼ä»–æ±€,ç‘èˆ’ä¼ä»–æ±€é’™,è¾›ä¼ä»–æ±€,æ™®ä¼ä»–æ±€,åŒ¹ä¼ä»–æ±€,æ°Ÿä¼ä»–æ±€,éè¯ºè´ç‰¹,è‹¯æ‰è´ç‰¹,å‰éç½—é½,ä¾æŠ˜éº¦å¸ƒ,è¡€è„‚åº·,è„‚å¿…å¦¥",
    "é™ç³–è¯": "äºŒç”²åŒèƒ,ç›é…¸äºŒç”²åŒèƒ,æ ¼åˆ—ç¾è„²,æ ¼åˆ—é½ç‰¹,æ ¼åˆ—å¡å—ª,æ ¼åˆ—å–¹é…®,ç‘æ ¼åˆ—å¥ˆ,é‚£æ ¼åˆ—å¥ˆ,é˜¿å¡æ³¢ç³–,ä¼æ ¼åˆ—æ³¢ç³–,ç±³æ ¼åˆ—é†‡,æ©æ ¼åˆ—å‡€,è¾¾æ ¼åˆ—å‡€,åˆ©æ‹‰é²è‚½,è‰¾å¡é‚£è‚½,è¥¿æ ¼åˆ—æ±€,æ²™æ ¼åˆ—æ±€,ç»´æ ¼åˆ—æ±€,åˆ©æ ¼åˆ—æ±€,æ³¨å°„ç”¨èƒ°å²›ç´ ,ç”˜ç²¾èƒ°å²›ç´ ,é—¨å†¬èƒ°å²›ç´ ,åœ°ç‰¹èƒ°å²›ç´ ,èµ–è„¯èƒ°å²›ç´ ",
    "æ¶ˆåŒ–ç³»ç»Ÿ": "å¥¥ç¾æ‹‰å”‘,å…°ç´¢æ‹‰å”‘,é›·è´æ‹‰å”‘,æ³®æ‰˜æ‹‰å”‘,åŸƒç´¢ç¾æ‹‰å”‘,å¤šæ½˜ç«‹é…®,è«æ²™å¿…åˆ©,ç”²æ°§æ°¯æ™®èƒº,é“ç¢³é…¸é•,è’™è„±çŸ³æ•£,å¼€å¡éœ²,ä¹³æœç³–,èšä¹™äºŒé†‡,æ¶ˆæ—‹å¡å¤šæ›²,åŒ¹ç»´æº´é“µ,æ›²ç¾å¸ƒæ±€,é©¬æ¥é…¸æ›²ç¾å¸ƒæ±€,ç†Šå»æ°§èƒ†é…¸,å¤æ–¹ç”˜è‰é…¸è‹·,è¿˜åŸå‹è°·èƒ±ç”˜è‚½,ç¡«ç³–é“,èƒ¶ä½“æœèƒ¶é“‹,é“é•åŠ æ··æ‚¬æ¶²,æ³•è«æ›¿ä¸,é›·å°¼æ›¿ä¸,è¥¿å’ªæ›¿ä¸",
    "æŠ—è¿‡æ•": "æ°¯é›·ä»–å®š,è¥¿æ›¿åˆ©å—ª,å’ªå”‘æ–¯æ±€,éç´¢éé‚£å®š,ä¾å·´æ–¯æ±€,åœ°æ°¯é›·ä»–å®š,å·¦è¥¿æ›¿åˆ©å—ª,è‹¯æµ·æ‹‰æ˜,æ°¯è‹¯é‚£æ•,èµ›åºšå•¶,ç‰¹éé‚£å®š,é˜¿ä¼æ–¯æ±€,æ°®ä“¬æ–¯æ±€,å¢å¸•ä»–å®š,æ¯”æ‹‰æ–¯æ±€",
    "çš®è‚¤ç”¨è¯": "åœ°å¥ˆå¾·,ç³ é…¸è«ç±³æ¾,å¤ç±³æ¾,å“ˆè¥¿å¥ˆå¾·,ä»–å…‹è«å¸,å¡ç¾è«å¸,ä¸é…¸æ°¢åŒ–å¯çš„æ¾,é†‹é…¸æ›²å®‰å¥ˆå¾·,æ°Ÿè½»æ¾,å¤æ–¹é†‹é…¸åœ°å¡ç±³æ¾,å’ªå–¹è«ç‰¹,é‡ç»„äººè¡¨çš®ç”Ÿé•¿å› å­",
    "å¿ƒè¡€ç®¡": "å•ç¡é…¸å¼‚å±±æ¢¨é…¯,ç¡é…¸ç”˜æ²¹,ç¾æ‰˜æ´›å°”,æ¯”ç´¢æ´›å°”,èƒºç¢˜é…®,åœ°é«˜è¾›,åæ³•æ—,åˆ©ä¼æ²™ç­,è¾¾æ¯”åŠ ç¾¤é…¯,é˜¿å¸åŒ¹æ—è‚ æº¶ç‰‡,ç¡«é…¸æ°¢æ°¯å¡æ ¼é›·,æ›¿æ ¼ç‘æ´›,å²å“šå¸ƒèŠ¬,é˜¿æ‰˜ä¼ä»–æ±€,ç‘èˆ’ä¼ä»–æ±€,è¾›ä¼ä»–æ±€,æ°¨æ°¯åœ°å¹³,ç¡è‹¯åœ°å¹³,éæ´›åœ°å¹³,å„è´æ²™å¦,ç¼¬æ²™å¦,æ›¿ç±³æ²™å¦,æ°¯æ²™å¦,æ™®è˜æ´›å°”,ç»´æ‹‰å¸•ç±³,åœ°å°”ç¡«ä“¬,æ›²ç¾ä»–å—ª,å°¼å¯åœ°å°”,å¤æ–¹ä¸¹å‚æ»´ä¸¸,é€šå¿ƒç»œ,é€Ÿæ•ˆæ•‘å¿ƒä¸¸",
    "ä¸­æˆè¯": "è¿èŠ±æ¸…ç˜Ÿ,æ¿è“æ ¹é¢—ç²’,åŒé»„è¿å£æœæ¶²,è—¿é¦™æ­£æ°”æ°´,å…­å‘³åœ°é»„ä¸¸,é€é¥ä¸¸,å¤æ–¹ä¸¹å‚æ»´ä¸¸,å®‰å®«ç‰›é»„ä¸¸,ç‰›é»„è§£æ¯’ç‰‡,é‡‘é“¶èŠ±éœ²,æ„Ÿå†’çµé¢—ç²’,ç»´Cé“¶ç¿˜ç‰‡,999æ„Ÿå†’çµ,æ„Ÿåº·,å¿«å…‹,æ³°è¯º,ç™½åŠ é»‘,æ—¥å¤œç™¾æœå’›,åŒä»å ‚æ„Ÿå†’æ¸…çƒ­é¢—ç²’,å°æŸ´èƒ¡é¢—ç²’,æ­£æŸ´èƒ¡é¥®é¢—ç²’,999èƒƒæ³°,ä¸‰ä¹èƒƒæ³°,èƒƒè‹é¢—ç²’,æ°”æ»èƒƒç—›é¢—ç²’,æ¸©èƒƒèˆ’,å…»èƒƒèˆ’,èˆ’è‚å¥èƒƒä¸¸,é¦™ç ‚å…»èƒƒä¸¸,ä¿å’Œä¸¸,è¡¥ä¸­ç›Šæ°”ä¸¸,å½’è„¾ä¸¸,é™„å­ç†ä¸­ä¸¸,å‚è‹“ç™½æœ¯æ•£,è—¿é¦™æ­£æ°”ä¸¸",
    "ç»´ç”Ÿç´ ": "ç»´ç”Ÿç´ C,ç»´ç”Ÿç´ B1,ç»´ç”Ÿç´ B2,ç»´ç”Ÿç´ B6,ç»´ç”Ÿç´ B12,ç»´ç”Ÿç´ E,ç»´ç”Ÿç´ AD,ç»´ç”Ÿç´ Dæ»´å‰‚,å¤åˆç»´ç”Ÿç´ B,å¤šç»´å…ƒç´ ç‰‡,21é‡‘ç»´ä»–,å–„å­˜,é‡‘æ–½å°”åº·",
    "å…¶ä»–": "ç¢˜ä¼,åŒ»ç”¨é…’ç²¾,ç”Ÿç†ç›æ°´,æ°¯åŒ–é’¾ç¼“é‡Šç‰‡,è‘¡è„ç³–é…¸é’™,ç¢³é…¸é’™D3,æ¸æ©¼é…¸é’™,ä¹³é…¸é’™,é¾™ç‰¡å£®éª¨é¢—ç²’,è‘¡è„ç³–é…¸é’™å£æœæ¶²,æ°¨ç³–ç¾,ç¡«é…¸æ°¨åŸºè‘¡è„ç³–,ç›é…¸æ°¨åŸºè‘¡è„ç³–,ç»ç’ƒé…¸é’ ,ç¡«é…¸è½¯éª¨ç´ ,é€æ˜è´¨é…¸é’ ",
    "å‘¼å¸ç³»ç»Ÿ": "ç›é…¸æ°¨æº´ç´¢,æº´å·±æ–°,ä¹™é…°åŠèƒ±æ°¨é…¸,ç¦å¤šå¸å¦,å„å¤šå¸å¦,å³ç¾æ²™èŠ¬,å–·æ‰˜ç»´æ—,æ°¨èŒ¶ç¢±,å¤šç´¢èŒ¶ç¢±,äºŒç¾Ÿä¸™èŒ¶ç¢±,å¸ƒåœ°å¥ˆå¾·,ä¸™é…¸æ°Ÿæ›¿å¡æ¾,æ²™ä¸èƒºé†‡,å¼‚ä¸™æ‰˜æº´é“µ,å™»æ‰˜æº´é“µ,å­Ÿé²å¸ç‰¹é’ ,æ‰é²å¸ç‰¹,æ™®ä»‘å¸ç‰¹,ç¦è«ç‰¹ç½—,æ²™ç¾ç‰¹ç½—,å¦¥æ´›ç‰¹ç½—,è«ç±³æ¾,å€æ°¯ç±³æ¾",
    "æ³Œå°¿ç³»ç»Ÿ": "å¦ç´¢ç½—è¾›,éé‚£é›„èƒº,å¦æ´›æ–°,å“ˆä¹,ä¿åˆ—æ²»,æ™®é€‚æ³°,ç‰¹æ‹‰å”‘å—ª,å¤šæ²™å”‘å—ª,é˜¿å¤«å”‘å—ª,ç´¢åˆ©é‚£æ–°,å‰åˆ—åº·,å‰åˆ—èˆ’é€š,ç™ƒé—­èˆ’,å®æ³Œæ³°,ä¼˜åˆ©ç¦,ç¿æ²¥é€š,ç™ƒæ¸…ç‰‡,ç›é…¸å¦ç´¢ç½—è¾›,ç›é…¸ç‰¹æ‹‰å”‘å—ª",
    "ç¥ç»ç³»ç»Ÿ": "å¸ƒæ´›èŠ¬ç¼“é‡Šèƒ¶å›Š,åŒæ°¯èŠ¬é…¸é’ è‚ æº¶ç‰‡,å¡æ¥æ˜”å¸ƒèƒ¶å›Š,ä¾æ‰˜è€ƒæ˜”ç‰‡,ç¾æ´›æ˜”åº·ç‰‡,å¡ç½—æ˜”åº·ç‰‡,æ°¯è¯ºæ˜”åº·ç‰‡,å¥ˆæ™®ç”Ÿèƒ¶å›Š,å²å“šç¾è¾›èƒ¶å›Š,é˜¿å¸åŒ¹æ—è‚ æº¶ç‰‡,å¯¹ä¹™é…°æ°¨åŸºé…šç‰‡,å¤æ–¹å¯¹ä¹™é…°æ°¨åŸºé…š,æ°¨é…šä¼ªéº»ç¾èŠ¬,é…šéº»ç¾æ•,æ°¨é…šé»„é‚£æ•,ç¾æ•ä¼ªéº»æº¶æ¶²",
    "å†…åˆ†æ³Œç§‘": "å·¦ç”²çŠ¶è…ºç´ é’ ,ä¼˜ç”²ä¹,é›·æ›¿æ–¯,ç”²å·¯å’ªå”‘,ä¸™ç¡«æ°§å˜§å•¶,æ ¼åˆ—æœ¬è„²,æ ¼åˆ—å¡å—ª,æ ¼åˆ—å–¹é…®,ç‘æ ¼åˆ—å¥ˆ,é‚£æ ¼åˆ—å¥ˆ,é˜¿å¡æ³¢ç³–,ä¼æ ¼åˆ—æ³¢ç³–,äºŒç”²åŒèƒ,ç›é…¸äºŒç”²åŒèƒ,æ ¼åˆ—ç¾è„²,è‰¾å¡é‚£è‚½,åˆ©æ‹‰é²è‚½,åº¦æ‹‰ç³–è‚½,å¸ç¾æ ¼é²è‚½,è¾¾æ ¼åˆ—å‡€,æ©æ ¼åˆ—å‡€,å¡æ ¼åˆ—å‡€",
    "ç²¾ç¥ç§‘": "ç›é…¸èˆæ›²æ—,æ°Ÿè¥¿æ±€,å¸•ç½—è¥¿æ±€,è¥¿é…æ™®å…°,è‰¾å¸è¥¿é…æ™®å…°,æ–‡æ‹‰æ³•è¾›,åº¦æ´›è¥¿æ±€,æ°Ÿä¼æ²™æ˜,æ›²å”‘é…®,ç±³æ°®å¹³,é˜¿æ™®å”‘ä»‘,è‰¾å¸å”‘ä»‘,åŠ³æ‹‰è¥¿æ³®,æ°¯ç¡è¥¿æ³®,åœ°è¥¿æ³®,æ°¯æ°®å¹³,å¥¥æ°®å¹³,å–¹ç¡«å¹³,åˆ©åŸ¹é…®,é˜¿ç«‹å“Œå”‘,é½æ‹‰è¥¿é…®,é˜¿å¡é‚£å¹³,ç¢³é…¸é”‚,ä¸™æˆŠé…¸é’ ,æ‹‰è«ä¸‰å—ª,åŠ å·´å–·ä¸,æ™®ç‘å·´æ—",
    "çœ¼ç§‘": "å·¦æ°§æ°Ÿæ²™æ˜Ÿæ»´çœ¼æ¶²,æ°§æ°Ÿæ²™æ˜Ÿæ»´çœ¼æ¶²,å¦¥å¸ƒéœ‰ç´ æ»´çœ¼æ¶²,çº¢éœ‰ç´ çœ¼è†,é‡‘éœ‰ç´ çœ¼è†,æ°¯éœ‰ç´ æ»´çœ¼æ¶²,åˆ©ç¦å¹³æ»´çœ¼æ¶²,å¤«è¥¿åœ°é…¸é’ æ»´çœ¼æ¶²,æ›´æ˜”æ´›éŸ¦çœ¼ç”¨å‡èƒ¶,é˜¿æ˜”æ´›éŸ¦æ»´çœ¼æ¶²,é‡ç»„äººè¡¨çš®ç”Ÿé•¿å› å­æ»´çœ¼æ¶²,ç»ç’ƒé…¸é’ æ»´çœ¼æ¶²,ç¾§ç”²åŸºçº¤ç»´ç´ é’ æ»´çœ¼æ¶²,èšä¹™çƒ¯é†‡æ»´çœ¼æ¶²,ä¸ƒå¶æ´‹åœ°é»„åŒè‹·æ»´çœ¼æ¶²,å°ç‰›è¡€å»è›‹ç™½æå–ç‰©çœ¼ç”¨å‡èƒ¶",
    "è€³é¼»å–‰": "ç³ é…¸è«ç±³æ¾é¼»å–·é›¾å‰‚,ä¸™é…¸æ°Ÿæ›¿å¡æ¾é¼»æ°”é›¾å‰‚,å¸ƒåœ°å¥ˆå¾·é¼»å–·é›¾å‰‚,ç›é…¸ç¾Ÿç”²å”‘å•‰å–·é›¾å‰‚,ç›é…¸èµ›æ´›å”‘å•‰æ»´é¼»æ¶²,å‘‹éº»æ»´é¼»æ¶²,è—¿èƒ†é¼»å–·é›¾å‰‚,é¼»ç‚åº·,é¼»ç‚å®,é¼»ç‚ç‰‡,é€šçªé¼»ç‚ç‰‡,éœèƒ†ä¸¸,è¾›å¤·é¼»ç‚ä¸¸,åƒæŸé¼»ç‚ç‰‡,é¼»æ¸Šé€šçªé¢—ç²’,é¼»æ¸Šèˆ’å£æœæ¶²,æ ‡å‡†æ¡ƒé‡‘æ²¹æ²¹æ»´é¼»æ¶²,è–„è·è„‘æ»´é¼»æ¶²,å¤æ–¹è–„è·è„‘æ»´é¼»æ¶²,ç›é…¸éº»é»„ç¢±æ»´é¼»æ¶²",
    "å¦‡ç§‘": "å…‹éœ‰å”‘é˜´é“ç‰‡,å’ªåº·å”‘æ “å‰‚,ç¡å‘‹å¤ªå°”åˆ¶éœ‰ç´ é˜´é“æ “,ç”²ç¡å”‘æ “,ç”²ç¡å”‘é˜´é“æ³¡è…¾ç‰‡,åŒå”‘æ³°æ “,ä¿å¦‡åº·æ “,æ¶ˆç³œæ “,æ´å°”é˜´æ´—æ¶²,çº¢æ ¸å¦‡æ´æ´—æ¶²,å¦‡ç‚æ´,èšç»´é…®ç¢˜å«æ¼±æ¶²,å…‹æ—éœ‰ç´ ç£·é…¸é…¯é˜´é“å‡èƒ¶,å£¬è‹¯é†‡é†š,è‹¯æ‰æ°¯é“µ,ä¹³é…¸èŒé˜´é“èƒ¶å›Š,å®šå›ç”Ÿ,ä¹Œé¸¡ç™½å‡¤ä¸¸,é€é¥ä¸¸,åŠ å‘³é€é¥ä¸¸,ä¸¹æ €é€é¥ä¸¸,å¦‡ç§‘åƒé‡‘ç‰‡,èŠ±çº¢ç‰‡,æŠ—å®«ç‚ç‰‡,ä¿æµä¸¸,è‰¾é™„æš–å®«ä¸¸,ç›Šæ¯è‰é¢—ç²’",
    "å„¿ç§‘": "å°å„¿æ°¨é…šé»„é‚£æ•é¢—ç²’,å°å„¿å¸ƒæ´›èŠ¬æ “,å°å„¿æ°¨é…šçƒ·é‚£æ•é¢—ç²’,å°å„¿æ„Ÿå†’é¢—ç²’,å°å„¿çƒ­é€Ÿæ¸…å£æœæ¶²,å°å„¿å’½æ‰é¢—ç²’,å°å„¿è§£æ„Ÿåº·,å°å„¿æ­¢å’³ç³–æµ†,å°å„¿åŒ–ç—°æ­¢å’³é¢—ç²’,å°å„¿æ¶ˆç§¯æ­¢å’³å£æœæ¶²,é†’è„¾å…»å„¿é¢—ç²’,å©´å„¿å¥è„¾æ•£,å°å„¿åº·é¢—ç²’,å°å„¿ä¸ƒæ˜ŸèŒ¶,ç‹æ°ä¿èµ¤ä¸¸,ä¿å’Œä¸¸,è‡³å®é”­,å°å„¿å’³å–˜çµ,å°å„¿è‚ºçƒ­å’³å–˜å£æœæ¶²,å°å„¿è±‰ç¿˜æ¸…çƒ­é¢—ç²’,å¥å„¿æ¸…è§£æ¶²,å°å„¿çƒ­é€Ÿæ¸…",
    "éª¨ç§‘": "ç¡«é…¸æ°¨åŸºè‘¡è„ç³–,ç›é…¸æ°¨åŸºè‘¡è„ç³–,ç»ç’ƒé…¸é’ ,ç¡«é…¸è½¯éª¨ç´ ,åŒæ°¯èŠ¬é…¸é’ è‚ æº¶ç‰‡,å¡æ¥æ˜”å¸ƒèƒ¶å›Š,ä¾æ‰˜è€ƒæ˜”ç‰‡,ç¾æ´›æ˜”åº·ç‰‡,å¸ƒæ´›èŠ¬ç¼“é‡Šèƒ¶å›Š,æ´›ç´¢æ´›èŠ¬é’ ç‰‡,é˜¿å¸åŒ¹æ—è‚ æº¶ç‰‡,å¯¹ä¹™é…°æ°¨åŸºé…šç‰‡,å²å“šç¾è¾›èƒ¶å›Š,å¥ˆæ™®ç”Ÿèƒ¶å›Š,æ°¯è¯ºæ˜”åº·ç‰‡,å¡ç½—æ˜”åº·ç‰‡",
    "è‚¿ç˜¤ç§‘": "æ¥æ›²å”‘,é˜¿é‚£æ›²å”‘,ä¾è¥¿ç¾å¦,ä»–è«æ˜”èŠ¬,æ‰˜ç‘ç±³èŠ¬,æ°Ÿç»´å¸ç¾¤,å‰éæ›¿å°¼,å„æ´›æ›¿å°¼,åŸƒå…‹æ›¿å°¼,å¥¥å¸Œæ›¿å°¼,ç´¢æ‹‰éå°¼,èˆ’å°¼æ›¿å°¼,ä¼Šé©¬æ›¿å°¼,è¾¾æ²™æ›¿å°¼,å°¼æ´›æ›¿å°¼,æ‹‰å¸•æ›¿å°¼,å¸•å”‘å¸•å°¼,è´ä¼ç å•æŠ—,æ›²å¦¥ç å•æŠ—,åˆ©å¦¥æ˜”å•æŠ—,è¥¿å¦¥æ˜”å•æŠ—,ç¡¼æ›¿ä½ç±³,å¡é“‚,é¡ºé“‚,å¥¥æ²™åˆ©é“‚,ç´«æ‰é†‡,å¤šè¥¿ä»–èµ›,é•¿æ˜¥ç‘æ»¨,å‰è¥¿ä»–æ»¨,æ°Ÿå°¿å˜§å•¶,å¡åŸ¹ä»–æ»¨,æ›¿å‰å¥¥èƒ¶å›Š,ä¾æ‰˜æ³Šè‹·,å¤šæŸ”æ¯”æ˜Ÿ,è¡¨æŸ”æ¯”æ˜Ÿ",
    "è¡€æ¶²ç§‘": "åˆ©å¦¥æ˜”å•æŠ—,æ›²å¦¥ç å•æŠ—,ç”²æ°¨è¶å‘¤,ç¯ç£·é…°èƒº,é•¿æ˜¥æ–°ç¢±,é•¿æ˜¥åœ°è¾›,ä¾æ‰˜æ³Šè‹·,å¤šæŸ”æ¯”æ˜Ÿ,è¡¨æŸ”æ¯”æ˜Ÿ,æŸ”çº¢éœ‰ç´ ,é˜¿ç³–èƒè‹·,æ°Ÿè¾¾æ‹‰æ»¨,ç¾ŸåŸºè„²,ç™½æ¶ˆå®‰,å¹²æ‰°ç´ ,æ²™åˆ©åº¦èƒº,æ¥é‚£åº¦èƒº,æ³Šé©¬åº¦èƒº,ä¼Šæ²™ä½æ˜Ÿ,ç¡¼æ›¿ä½ç±³,åœ°è¥¿ä»–æ»¨,é˜¿æ‰èƒè‹·,æ›¿è«å”‘èƒº",
    "å…ç–«è°ƒèŠ‚": "ç¡«å”‘å˜Œå‘¤,ç”²æ°¨è¶å‘¤,ç¯å­¢ç´ ,ä»–å…‹è«å¸,éœ‰é…šé…¸é…¯,å’ªå”‘ç«‹å®¾,æ°Ÿè¾¾æ‹‰æ»¨,å…‹æ‹‰å±ˆæ»¨,é˜¿ç³–èƒè‹·,ç¾ŸåŸºè„²,ç™½æ¶ˆå®‰,å¹²æ‰°ç´ ,ç™½ä»‹ç´ -2,èƒ¸è…ºæ³•æ–°,é‡ç»„äººå¹²æ‰°ç´ Î±2b,é‡ç»„äººå¹²æ‰°ç´ Î±1b,é‡ç»„äººå¹²æ‰°ç´ Î³,èšä¹™äºŒé†‡å¹²æ‰°ç´ Î±-2a",
    "æŠ—ç—…æ¯’": "å¥¥å¸ä»–éŸ¦,æ‰é‚£ç±³éŸ¦,å¸•æ‹‰ç±³éŸ¦,é˜¿æ¯”å¤šå°”,åˆ©å·´éŸ¦æ—,æ›´æ˜”æ´›éŸ¦,ç¼¬æ›´æ˜”æ´›éŸ¦,ä¼æ˜”æ´›éŸ¦,æ³›æ˜”æ´›éŸ¦,é˜¿æ˜”æ´›éŸ¦,æ‹‰ç±³å¤«å®š,é˜¿å¾·ç¦éŸ¦é…¯,æ©æ›¿å¡éŸ¦,æ›¿æ¯”å¤«å®š,æ›¿è¯ºç¦éŸ¦,ç´¢ç£·å¸ƒéŸ¦,è¾¾å¡ä»–éŸ¦,å¥¥æ¯”ä»–éŸ¦,ç´¢ç£·å¸ƒéŸ¦,ç»´å¸•ä»–éŸ¦,æ ¼æ‹‰ç‘ç‘éŸ¦",
    "æŠ—çœŸèŒ": "æ°Ÿåº·å”‘,ä¼Šæ›²åº·å”‘,ä¼ç«‹åº·å”‘,æ³Šæ²™åº·å”‘,ä¸¤æ€§éœ‰ç´ B,åˆ¶éœ‰èŒç´ ,å…‹éœ‰å”‘,å’ªåº·å”‘,é…®åº·å”‘,ç‰¹æ¯”è˜èŠ¬,è”è‹¯è‹„å”‘,ä¼Šæ›²åº·å”‘,ä¼ç«‹åº·å”‘,æ³Šæ²™åº·å”‘,å¡æ³ŠèŠ¬å‡€,ç±³å¡èŠ¬å‡€,é˜¿è«ç½—èŠ¬,ç¯å¡é…®èƒº,èˆä»–åº·å”‘,æ°Ÿèƒå˜§å•¶",
    "æŠ—å¯„ç”Ÿè™«": "é˜¿è‹¯è¾¾å”‘,ç”²è‹¯å’ªå”‘,å¡å–¹é…®,æ°¯å–¹,é’è’¿ç´ ,è’¿ç”²é†š,åŒæ°¢é’è’¿ç´ ,é’è’¿ç¥é…¯,æœ¬èŠ´é†‡,ä¹™èƒºå—ª,ç¡å”‘å°¼ç‰¹",
}


# åˆ†ç±»æ˜ å°„
CATEGORY_MAPPING = {
    "æ„Ÿå†’å‘çƒ§": "æ„Ÿå†’å‘çƒ§",
    "æŠ—ç”Ÿç´ ": "æ„Ÿå†’å‘çƒ§",
    "é™å‹è¯": "å¿ƒè„‘è¡€ç®¡",
    "é™è„‚è¯": "å¿ƒè„‘è¡€ç®¡",
    "é™ç³–è¯": "å…¶ä»–",
    "æ¶ˆåŒ–ç³»ç»Ÿ": "æ¶ˆåŒ–ç³»ç»Ÿ",
    "æŠ—è¿‡æ•": "çš®è‚¤ç”¨è¯",
    "çš®è‚¤ç”¨è¯": "çš®è‚¤ç”¨è¯",
    "å¿ƒè¡€ç®¡": "å¿ƒè„‘è¡€ç®¡",
    "ä¸­æˆè¯": "å…¶ä»–",
    "ç»´ç”Ÿç´ ": "å…¶ä»–",
    "å…¶ä»–": "å…¶ä»–",
    "å‘¼å¸ç³»ç»Ÿ": "æ„Ÿå†’å‘çƒ§",
    "æ³Œå°¿ç³»ç»Ÿ": "å…¶ä»–",
    "ç¥ç»ç³»ç»Ÿ": "å…¶ä»–",
    "å†…åˆ†æ³Œç§‘": "å…¶ä»–",
    "ç²¾ç¥ç§‘": "å…¶ä»–",
    "çœ¼ç§‘": "å…¶ä»–",
    "è€³é¼»å–‰": "å…¶ä»–",
    "å¦‡ç§‘": "å…¶ä»–",
    "å„¿ç§‘": "å…¶ä»–",
    "éª¨ç§‘": "å…¶ä»–",
    "è‚¿ç˜¤ç§‘": "å…¶ä»–",
    "è¡€æ¶²ç§‘": "å…¶ä»–",
    "å…ç–«è°ƒèŠ‚": "å…¶ä»–",
    "æŠ—ç—…æ¯’": "æ„Ÿå†’å‘çƒ§",
    "æŠ—çœŸèŒ": "å…¶ä»–",
    "æŠ—å¯„ç”Ÿè™«": "å…¶ä»–",
}


class DXYDrugDownloader:
    """ä¸é¦™å›­è¯å“å¹¶å‘ä¸‹è½½å™¨"""

    def __init__(self, concurrency: int = 20):
        self.base_url = "https://drugs.dxy.cn"
        self.concurrency = concurrency
        self.stats = {
            'total': 0,
            'success': 0,
            'failed': 0,
            'no_result': 0
        }

    async def search_drug(self, client: httpx.AsyncClient, drug_name: str) -> Dict[str, Any]:
        """æœç´¢å•ä¸ªè¯å“"""
        try:
            response = await client.post(
                f"{self.base_url}/api/search",
                json={'keyword': drug_name, 'page': 1, 'size': 1},
                timeout=10.0
            )
            if response.status_code == 200:
                data = response.json()
                results = data.get('data', {}).get('list', [])
                if results and len(results) > 0:
                    result = results[0]
                    return {
                        'name': result.get('name', drug_name),
                        'english_name': result.get('enName'),
                        'indications': result.get('indication'),
                        'contraindications': result.get('contraindication'),
                        'dosage': result.get('dosage'),
                        'side_effects': result.get('adverseReaction'),
                        'precautions': result.get('precaution'),
                        'interactions': result.get('interaction'),
                        'source': 'ä¸é¦™å›­',
                        'search_matched': True
                    }
                else:
                    return {
                        'name': drug_name,
                        'source': 'ä¸é¦™å›­',
                        'search_matched': False,
                        'note': 'API æœªè¿”å›ç»“æœ'
                    }
            else:
                return {
                    'name': drug_name,
                    'source': 'ä¸é¦™å›­',
                    'search_matched': False,
                    'error': f'HTTP {response.status_code}'
                }
        except Exception as e:
            return {
                'name': drug_name,
                'source': 'ä¸é¦™å›­',
                'search_matched': False,
                'error': str(e)
            }

    async def fetch_category_drugs(
        self,
        client: httpx.AsyncClient,
        category_name: str,
        drug_names: List[str],
        mapped_category: str
    ) -> List[Dict]:
        """å¹¶å‘è·å–ä¸€ä¸ªåˆ†ç±»çš„æ‰€æœ‰è¯å“"""
        tasks = [self.search_drug(client, name.strip()) for name in drug_names if name.strip()]
        results = await asyncio.gather(*tasks)

        # æ·»åŠ åˆ†ç±»ä¿¡æ¯
        for result in results:
            result['category'] = mapped_category
            result['original_category'] = category_name
            self.stats['total'] += 1
            if result.get('search_matched'):
                self.stats['success'] += 1
            elif 'error' in result:
                self.stats['failed'] += 1
            else:
                self.stats['no_result'] += 1

        return results

    async def fetch_all(self) -> List[Dict]:
        """å¹¶å‘è·å–æ‰€æœ‰è¯å“"""
        start_time = time.time()
        all_results = []

        limits = httpx.Limits(max_keepalive_connections=50, max_connections=100)
        timeout = httpx.Timeout(10.0, connect=5.0)

        async with httpx.AsyncClient(
            limits=limits,
            timeout=timeout,
            headers={'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36'}
        ) as client:
            for category_name, drug_names_str in COMMON_DRUGS.items():
                drug_names = [n.strip() for n in drug_names_str.split(',') if n.strip()]
                mapped_category = CATEGORY_MAPPING.get(category_name, "å…¶ä»–")

                print(f"ğŸ“¦ æ­£åœ¨è·å– [{category_name}] ({len(drug_names)} ä¸ªè¯å“)...")

                results = await self.fetch_category_drugs(
                    client, category_name, drug_names, mapped_category
                )
                all_results.extend(results)

                # æ˜¾ç¤ºè¿›åº¦
                matched = sum(1 for r in results if r.get('search_matched'))
                print(f"   âœ“ åŒ¹é…: {matched}/{len(results)}")

                # é¿å…è¿‡è½½
                await asyncio.sleep(0.1)

        elapsed = time.time() - start_time
        print(f"\nâ±ï¸  æ€»è€—æ—¶: {elapsed:.2f} ç§’")
        print(f"ğŸ“Š æ€»è®¡: {self.stats['total']}, æˆåŠŸ: {self.stats['success']}, "
              f"æ— ç»“æœ: {self.stats['no_result']}, å¤±è´¥: {self.stats['failed']}")

        return all_results

    def save_to_json(self, results: List[Dict], output_path: str):
        """ä¿å­˜ä¸º JSON æ–‡ä»¶"""
        # æŒ‰åˆ†ç±»ç»„ç»‡æ•°æ®
        by_category = {}
        for result in results:
            cat = result.get('category', 'å…¶ä»–')
            if cat not in by_category:
                by_category[cat] = []
            by_category[cat].append(result)

        output_data = {
            'source': 'ä¸é¦™å›­è¯å“æ•°æ®åº“ (drugs.dxy.cn)',
            'fetched_at': time.strftime('%Y-%m-%d %H:%M:%S'),
            'stats': {
                'total': len(results),
                'by_category': {k: len(v) for k, v in by_category.items()}
            },
            'categories': by_category,
            'drugs': results
        }

        with open(output_path, 'w', encoding='utf-8') as f:
            json.dump(output_data, f, ensure_ascii=False, indent=2)

        print(f"ğŸ’¾ å·²ä¿å­˜åˆ°: {output_path}")


async def main():
    """ä¸»å‡½æ•°"""
    output_dir = Path(__file__).parent.parent.parent / "data"
    output_dir.mkdir(exist_ok=True)
    output_path = output_dir / "dxy_drugs.json"

    print("=" * 60)
    print("ä¸é¦™å›­è¯å“æ•°æ®å¹¶å‘ä¸‹è½½å™¨")
    print("=" * 60)

    downloader = DXYDrugDownloader(concurrency=20)
    results = await downloader.fetch_all()
    downloader.save_to_json(results, str(output_path))

    print("\nâœ… ä¸‹è½½å®Œæˆ!")


if __name__ == "__main__":
    asyncio.run(main())
