# PRD to Ralph Conversion Task

You are tasked with converting a Product Requirements Document (PRD) or specification into Ralph for Claude Code format.

## Input Analysis
Analyze the provided specification file and extract:
- Project goals and objectives
- Core features and requirements
- Technical constraints and preferences
- Priority levels and phases
- Success criteria

## Required Outputs

Create these files in the .ralph/ subdirectory:

### 1. .ralph/PROMPT.md
Transform the PRD into Ralph development instructions:
```markdown
# Ralph Development Instructions

## Context
You are Ralph, an autonomous AI development agent working on a [PROJECT NAME] project.

## Current Objectives
[Extract and prioritize 4-6 main objectives from the PRD]

## Key Principles
- ONE task per loop - focus on the most important thing
- Search the codebase before assuming something isn't implemented
- Use subagents for expensive operations (file searching, analysis)
- Write comprehensive tests with clear documentation
- Update @fix_plan.md with your learnings
- Commit working changes with descriptive messages

## ğŸ§ª Testing Guidelines (CRITICAL)
- LIMIT testing to ~20% of your total effort per loop
- PRIORITIZE: Implementation > Documentation > Tests
- Only write tests for NEW functionality you implement
- Do NOT refactor existing tests unless broken
- Focus on CORE functionality first, comprehensive testing later

## Project Requirements
[Convert PRD requirements into clear, actionable development requirements]

## Technical Constraints
[Extract any technical preferences, frameworks, languages mentioned]

## Success Criteria
[Define what "done" looks like based on the PRD]

## Current Task
Follow @fix_plan.md and choose the most important item to implement next.
```

### 2. .ralph/@fix_plan.md
Convert requirements into a prioritized task list:
```markdown
# Ralph Fix Plan

## High Priority
[Extract and convert critical features into actionable tasks]

## Medium Priority
[Secondary features and enhancements]

## Low Priority
[Nice-to-have features and optimizations]

## Completed
- [x] Project initialization

## Notes
[Any important context from the original PRD]
```

### 3. .ralph/specs/requirements.md
Create detailed technical specifications:
```markdown
# Technical Specifications

[Convert PRD into detailed technical requirements including:]
- System architecture requirements
- Data models and structures
- API specifications
- User interface requirements
- Performance requirements
- Security considerations
- Integration requirements

[Preserve all technical details from the original PRD]
```

## Instructions
1. Read and analyze the attached specification file
2. Create the three files above with content derived from the PRD
3. Ensure all requirements are captured and properly prioritized
4. Make the PROMPT.md actionable for autonomous development
5. Structure @fix_plan.md with clear, implementable tasks


---

## Source PRD File: 2026-01-21-doctor-avatar-system-improvement.md

# åŒ»ç”Ÿåˆ†èº«ç³»ç»Ÿå®Œå–„æ–¹æ¡ˆ

**æ—¥æœŸ:** 2026-01-21
**ç›®æ ‡:** å®Œå–„æŸ¥ç—…æŸ¥è¯æ•°æ®ã€ç•Œé¢åŠŸèƒ½ã€åŒ»ç”Ÿåˆ†èº«åˆ›å»ºæµç¨‹

---

## ä¸€ã€æŸ¥ç—…æŸ¥è¯çœŸå®æ•°æ®æ–¹æ¡ˆ

### 1.1 æ•°æ®æºè§„åˆ’

| æ•°æ®ç±»å‹ | æ•°æ®æº | æ•°é‡ | è¯´æ˜ |
|---------|--------|------|------|
| **ç–¾ç—…æ•°æ®** | ICD-10 å›½å®¶æ ‡å‡†ç¼–ç  | ~1.4ä¸‡æ¡ | å›½å®¶åŒ»ä¿ç‰ˆï¼Œå«ç–¾ç—…ç¼–ç ã€åç§°ã€åˆ†ç±» |
| **è¯å“æ•°æ®** | å›½å®¶è¯ç›‘å±€æ•°æ®åº“ | ~15ä¸‡æ¡ | å«æ‰¹å‡†æ–‡å·ã€ç”Ÿäº§ä¼ä¸šã€é€‚åº”ç—‡ |

### 1.2 æ•°æ®å¯¼å…¥æµç¨‹

```
1. è·å–å…¬å¼€æ•°æ®é›†ï¼ˆCSV/JSONæ ¼å¼ï¼‰
   â”œâ”€â”€ ç–¾ç—…ï¼šICD-10ç¼–ç æ˜ å°„è¡¨
   â””â”€â”€ è¯å“ï¼šå›½å®¶è¯ç›‘å±€æ‰¹å‡†è¯å“åº“

2. æ•°æ®æ¸…æ´—ä¸è½¬æ¢
   â”œâ”€â”€ ç»Ÿä¸€å­—æ®µæ ¼å¼
   â”œâ”€â”€ å»ºç«‹ç§‘å®¤å…³è”
   â””â”€â”€ è¡¥å……åŸºç¡€ä¿¡æ¯

3. æ‰¹é‡å¯¼å…¥æ•°æ®åº“
   â”œâ”€â”€ ä½¿ç”¨ migrations è„šæœ¬
   â””â”€â”€ ä¿ç•™åŸæœ‰ç§å­æ•°æ®

4. äººå·¥è¡¥å……å®Œå–„
   â”œâ”€â”€ åŒ»ç”Ÿåå°ç¼–è¾‘è¯¦æƒ…
   â”œâ”€â”€ æ·»åŠ ç—‡çŠ¶ã€è¯Šæ–­ã€æ²»ç–—ç­‰å†…å®¹
   â””â”€â”€ å®¡æ ¸æœºåˆ¶ï¼ˆæäº¤â†’å®¡æ ¸â†’å‘å¸ƒï¼‰
```

### 1.3 æ•°æ®æ¨¡å‹è¡¥å……

ç°æœ‰æ¨¡å‹å·²å®Œå–„ï¼Œå¯¼å…¥åéœ€è¡¥å……çš„å­—æ®µï¼š
- `overview`, `symptoms`, `causes`, `diagnosis`, `treatment`, `prevention`, `care`
- `indications`, `contraindications`, `dosage`, `side_effects`, `precautions`

---

## äºŒã€ç•Œé¢åŠŸèƒ½å®Œå–„æ–¹æ¡ˆ

### 2.1 iOS æ‚£è€…ç«¯

| é¡µé¢ | ä¼˜å…ˆçº§ | å¾…å®ç°åŠŸèƒ½ |
|------|--------|-----------|
| **æŸ¥ç—…æŸ¥è¯** | P0 | ç–¾ç—…/è¯å“è¯¦æƒ…é¡µè·³è½¬ã€å®Œæ•´ä¿¡æ¯å±•ç¤º |
| **ç—…å†èµ„æ–™å¤¹** | P1 | PDFå¯¼å‡ºã€ç¬”è®°æ·»åŠ /ç¼–è¾‘ |
| **é—®åŒ»ç”Ÿ** | P2 | å›¾ç‰‡æ¶ˆæ¯ã€è¯­éŸ³æ¶ˆæ¯å®Œæ•´æµç¨‹ |
| **ä¸ªäººä¸­å¿ƒ** | P2 | è®¾ç½®é¡µé¢ã€æ„è§åé¦ˆ |

### 2.2 ç®¡ç†åå°

| é¡µé¢ | å¾…å®ç°åŠŸèƒ½ |
|------|-----------|
| **çŸ¥è¯†åº“ç®¡ç†** | æ–‡æ¡£ä¸Šä¼ ã€é‡æ–°ç´¢å¼•ã€æ–‡æ¡£åˆ—è¡¨ |
| **åŒ»ç”Ÿç®¡ç†** | ç¼–è¾‘ã€æ¿€æ´»/åœç”¨ã€åˆ†èº«é…ç½® |
| **æ•°æ®ç»Ÿè®¡** | çœŸå®æ•°æ®å›¾è¡¨ã€è¶‹åŠ¿åˆ†æ |

---

## ä¸‰ã€åŒ»ç”Ÿåˆ†èº«åˆ›å»ºæµç¨‹

### 3.1 æµç¨‹è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŒ»ç”Ÿåˆ†èº«åˆ›å»ºæµç¨‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Step 1: åŸºç¡€ä¿¡æ¯å½•å…¥ï¼ˆç®¡ç†å‘˜æ“ä½œï¼‰                           â”‚
â”‚  â”œâ”€â”€ å§“åã€èŒç§°ã€ç§‘å®¤ã€åŒ»é™¢                                  â”‚
â”‚  â”œâ”€â”€ å¤´åƒã€ç®€ä»‹                                              â”‚
â”‚  â””â”€â”€ åˆ›å»ºåŒ»ç”Ÿè®°å½•                                            â”‚
â”‚         â†“                                                   â”‚
â”‚  Step 2: å¯¹è¯å¼é‡‡é›†ï¼ˆåŒ»ç”Ÿæ“ä½œï¼Œ10-15åˆ†é’Ÿï¼‰                   â”‚
â”‚  â”œâ”€â”€ AI å¼•å¯¼å¯¹è¯ï¼Œæå–é—®è¯Šé£æ ¼                               â”‚
â”‚  â”‚   â”œâ”€ "æ‚¨é€šå¸¸ä¼šå…ˆé—®æ‚£è€…ä»€ä¹ˆï¼Ÿ"                            â”‚
â”‚  â”‚   â”œâ”€ "çœ‹åˆ°çš®æŸç…§ç‰‡ï¼Œæ‚¨æœ€å…³æ³¨ä»€ä¹ˆï¼Ÿ"                      â”‚
â”‚  â”‚   â”œâ”€ "æ‚¨ä¼šç»™æ‚£è€…å“ªäº›ç”Ÿæ´»å»ºè®®ï¼Ÿ"                          â”‚
â”‚  â”‚   â””â”€ ...                                                 â”‚
â”‚  â”œâ”€â”€ AI å®æ—¶ç”Ÿæˆï¼šai_persona_prompt                         â”‚
â”‚  â””â”€ åŒ»ç”Ÿç¡®è®¤/è°ƒæ•´                                           â”‚
â”‚         â†“                                                   â”‚
â”‚  Step 3: ç—…å†åˆ†æï¼ˆå¯é€‰ï¼Œæå‡åˆ†èº«è´¨é‡ï¼‰                      â”‚
â”‚  â”œâ”€â”€ ä¸Šä¼ è¿‡å¾€ç—…å†ï¼ˆè„±æ•åï¼‰                                  â”‚
â”‚  â”œâ”€â”€ AI åˆ†æï¼šè¯Šæ–­æ€è·¯ã€ç”¨è¯ä¹ æƒ¯                             â”‚
â”‚  â””â”€ æ›´æ–° knowledge_base_id                                  â”‚
â”‚         â†“                                                   â”‚
â”‚  Step 4: åˆ†èº«æ¿€æ´»                                           â”‚
â”‚  â””â”€â”€ åŒ»ç”Ÿåˆ†èº«ä¸Šçº¿ï¼Œå¼€å§‹æ¥å¾…æ‚£è€…                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å¯¹è¯å¼é‡‡é›†è¯¦ç»†è®¾è®¡

**é‡‡é›†ç»´åº¦ï¼š**

| ç»´åº¦ | é‡‡é›†å†…å®¹ | ç”Ÿæˆå­—æ®µ |
|------|----------|----------|
| **é—®è¯Šé¡ºåº** | é¦–è¯Š/å¤è¯Šçš„æé—®ä¹ æƒ¯ | `ai_persona_prompt` ä¸­çš„é—®è¯Šæµç¨‹ |
| **å…³æ³¨é‡ç‚¹** | æœ€å…³æ³¨çš„ç—‡çŠ¶/æŒ‡æ ‡ | prompt ä¸­çš„é‡ç‚¹å…³æ³¨é¡¹ |
| **æ²Ÿé€šé£æ ¼** | è¯´è¯æ–¹å¼ï¼ˆæ¸©å’Œ/ä¸“ä¸š/ç®€æ´ï¼‰ | prompt ä¸­çš„è¯­æ°”è®¾å®š |
| **å¤„æ–¹ä¹ æƒ¯** | ä¿å®ˆ/ç§¯æ/ä¸­ç­‰ | prompt ä¸­çš„ç”¨è¯åŸåˆ™ |
| **ç”Ÿæ´»å»ºè®®** | å¸¸ç»™æ‚£è€…çš„å»ºè®® | prompt ä¸­çš„å»ºè®®æ¨¡æ¿ |

**å¯¹è¯ç¤ºä¾‹ï¼ˆçš®è‚¤ç§‘ï¼‰ï¼š**

```
AIï¼šåŒ»ç”Ÿæ‚¨å¥½ï¼Œæˆ‘æ˜¯é‘«ç³åŒ»ç”Ÿç³»ç»Ÿçš„åŠ©æ‰‹ã€‚ä»Šå¤©å¸®æ‚¨åˆ›å»ºAIåˆ†èº«ï¼Œ
    å¤§æ¦‚éœ€è¦10-15åˆ†é’Ÿã€‚æˆ‘ä»¬ä»é—®è¯Šä¹ æƒ¯å¼€å§‹èŠèµ·ã€‚

AIï¼šå½“æ‚£è€…è¯´"èº«ä¸Šç—’"æ—¶ï¼Œæ‚¨é€šå¸¸ä¼šæ€ä¹ˆé—®ï¼Ÿ

åŒ»ç”Ÿï¼šæˆ‘ä¼šå…ˆé—®ç—’äº†å¤šä¹…ï¼Œåœ¨ä»€ä¹ˆéƒ¨ä½ï¼Œç„¶åé—®æœ‰æ²¡æœ‰åŠ é‡æˆ–ç¼“è§£çš„å› ç´ ã€‚

AIï¼šæ˜ç™½äº†ï¼Œæ‚¨ä¹ æƒ¯å…ˆäº†è§£ç—…å²å’Œæ—¶é—´çº¿ã€‚é‚£å¦‚æœæ‚£è€…è¯´è¿™æ˜¯ç¬¬ä¸€æ¬¡å‘ç—…ï¼Œ
    æ‚¨ä¼šæ¥ç€é—®ä»€ä¹ˆï¼Ÿ

åŒ»ç”Ÿï¼šæˆ‘ä¼šé—®æœ€è¿‘æœ‰æ²¡æœ‰æ¢æ´—è¡£æ¶²ã€åƒè¿‡ä»€ä¹ˆè¯ã€æœ‰æ²¡æœ‰æ¥è§¦è¿‡ä»€ä¹ˆæ–°ä¸œè¥¿ã€‚

AIï¼šå¥½çš„ï¼Œæ‚¨ä¼šè€ƒè™‘æ¥è§¦æ€§å› ç´ ã€‚é‚£çœ‹åˆ°çš®æŸç…§ç‰‡æ—¶ï¼Œæ‚¨æœ€å…³æ³¨ä»€ä¹ˆï¼Ÿ

åŒ»ç”Ÿï¼šæˆ‘çœ‹çš®æŸçš„å½¢æ€ã€é¢œè‰²ã€åˆ†å¸ƒï¼Œè¿˜æœ‰æœ‰æ²¡æœ‰æŠ“ç—•ã€‚

...ï¼ˆç»§ç»­å¯¹è¯ï¼‰

AIï¼šæˆ‘æ ¹æ®åˆšæ‰çš„å¯¹è¯ï¼Œä¸ºæ‚¨ç”Ÿæˆäº†åˆ†èº«çš„äººè®¾æç¤ºè¯ï¼Œè¯·æ‚¨ç¡®è®¤ï¼š

    "ä½ æ˜¯ä¸€ä½æ¸©å’Œäº²åˆ‡çš„çš®è‚¤ç§‘åŒ»ç”Ÿï¼Œæ“…é•¿æ¹¿ç–¹ã€çš®ç‚ã€è¨éº»ç–¹ç­‰å¸¸è§çš®è‚¤ç—…ã€‚
    é—®è¯Šæ—¶ï¼Œä½ ä¹ æƒ¯å…ˆäº†è§£ç—…å²å’Œæ—¶é—´çº¿ï¼Œç„¶åè¯¢é—®å¯èƒ½çš„æ¥è§¦æ€§å› ç´ ã€‚
    çœ‹çš®æŸç…§ç‰‡æ—¶ï¼Œä½ æœ€å…³æ³¨çš®æŸçš„å½¢æ€ã€é¢œè‰²ã€åˆ†å¸ƒå’ŒæŠ“ç—•æƒ…å†µ..."

åŒ»ç”Ÿï¼šè¿™ä¸ªæ¦‚æ‹¬å¾ˆå‡†ç¡®ï¼Œå¯ä»¥ã€‚

AIï¼šå¤ªå¥½äº†ï¼æ¥ä¸‹æ¥ï¼Œæ‚¨è¦ä¸è¦ä¸Šä¼ ä¸€äº›è¿‡å¾€çš„ç—…å†ï¼Ÿ
    è¿™æ ·å¯ä»¥è®©åˆ†èº«æ›´æ¥è¿‘æ‚¨çš„çœŸå®è¯Šç–—é£æ ¼ã€‚

åŒ»ç”Ÿï¼šå¥½çš„ï¼Œæˆ‘ä¼ å‡ ä»½æ¹¿ç–¹çš„ç—…å†ã€‚
```

### 3.3 ç—…å†åˆ†æåŠŸèƒ½

**è¾“å…¥ï¼š** åŒ»ç”Ÿä¸Šä¼ çš„è„±æ•ç—…å†ï¼ˆJSON/CSVæ ¼å¼ï¼‰

**åˆ†æå†…å®¹ï¼š**
- å¸¸ç”¨è¯Šæ–­æ€è·¯
- å¤„æ–¹ç”¨è¯è§„å¾‹
- éšè®¿ä¹ æƒ¯
- ç‰¹æ®Šå¤„ç†æ–¹å¼

**è¾“å‡ºï¼š**
- æ›´æ–° `knowledge_base_id`
- è¡¥å…… `ai_persona_prompt` çš„ç»†èŠ‚

---

## å››ã€æŠ€æœ¯å®ç°è¦ç‚¹

### 4.1 æ•°æ®å¯¼å…¥

```python
# backend/scripts/import_medical_data.py
- æ”¯æŒ ICD-10 CSV å¯¼å…¥
- æ”¯æŒè¯ç›‘å±€æ•°æ®åº“å¯¼å…¥
- æ‰¹é‡å¤„ç†ï¼Œè¿›åº¦æ˜¾ç¤º
- é”™è¯¯æ—¥å¿—è®°å½•
```

### 4.2 å¯¹è¯å¼é‡‡é›†

```python
# æ–°å¢ API: /admin/doctors/{id}/persona-chat
- WebSocket é•¿è¿æ¥å¯¹è¯
- å®æ—¶æå–å¹¶æ›´æ–° ai_persona_prompt
- æ”¯æŒåŒ»ç”Ÿç¡®è®¤/è°ƒæ•´
```

### 4.3 ç—…å†åˆ†æ

```python
# æ–°å¢ API: /admin/doctors/{id}/analyze-records
- ä¸Šä¼ ç—…å†æ–‡ä»¶
- AI åˆ†ææå–ç‰¹å¾
- æ›´æ–°çŸ¥è¯†åº“å’Œ prompt
```

---

## äº”ã€æ•°æ®æ¨¡å‹æ›´æ–°

### Doctor æ¨¡å‹ï¼ˆå·²æœ‰ï¼Œæ— éœ€æ”¹åŠ¨ï¼‰

```python
class Doctor(Base):
    # åŸºç¡€ä¿¡æ¯
    name, title, department_id, hospital, specialty, intro, avatar_url

    # AI åˆ†èº«æ ¸å¿ƒ
    ai_persona_prompt      # å¯¹è¯å¼é‡‡é›†ç”Ÿæˆ
    ai_model               # é»˜è®¤ qwen-plus
    ai_temperature         # é»˜è®¤ 0.7
    ai_max_tokens          # é»˜è®¤ 500
    knowledge_base_id      # ç—…å†åˆ†æåæ›´æ–°
    agent_type             # é»˜è®¤ simpleï¼Œå¯å‡çº§ä¸º react
    agent_config           # JSON é…ç½®

    # çŠ¶æ€
    persona_completed      # æ–°å¢ï¼šå¯¹è¯é‡‡é›†æ˜¯å¦å®Œæˆ
    records_analyzed       # æ–°å¢ï¼šç—…å†åˆ†ææ˜¯å¦å®Œæˆ
```

---

## å…­ã€å®æ–½ä¼˜å…ˆçº§

| é˜¶æ®µ | å†…å®¹ | ä¼°æ—¶ |
|------|------|------|
| **Phase 1** | æŸ¥ç—…æŸ¥è¯æ•°æ®å¯¼å…¥ | 2-3å¤© |
| **Phase 2** | iOS æŸ¥ç—…æŸ¥è¯è¯¦æƒ…é¡µ | 1-2å¤© |
| **Phase 3** | å¯¹è¯å¼é‡‡é›†åŠŸèƒ½ | 3-4å¤© |
| **Phase 4** | ç—…å†åˆ†æåŠŸèƒ½ | 2-3å¤© |
| **Phase 5** | å…¶ä»–ç•Œé¢åŠŸèƒ½å®Œå–„ | æŒç»­ |

---

## ä¸ƒã€éªŒæ”¶æ ‡å‡†

- [ ] ç–¾ç—…åº“å¯¼å…¥ â‰¥1000 æ¡çœŸå®æ•°æ®
- [ ] è¯å“åº“å¯¼å…¥ â‰¥500 æ¡çœŸå®æ•°æ®
- [ ] iOS æŸ¥ç—…æŸ¥è¯è¯¦æƒ…é¡µå¯æ­£å¸¸è·³è½¬
- [ ] å¯¹è¯å¼é‡‡é›†å¯åœ¨15åˆ†é’Ÿå†…å®Œæˆ
- [ ] ç”Ÿæˆçš„ ai_persona_prompt å¯ç”¨
- [ ] ç—…å†åˆ†æå¯æ­£ç¡®æå–ç‰¹å¾

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.0*
