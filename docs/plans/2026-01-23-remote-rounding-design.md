# 远程查房系统设计方案

**日期**: 2026-01-23
**版本**: 1.0
**状态**: 待实现

---

## 一、产品定位

### 1.1 核心场景

**家庭医疗/远程查房** - 医生通过Web端远程管理居家患者

```
┌─────────────────────────────────────────────────────────────┐
│                    远程查房工作流                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  居家患者  ──问诊──▶  AI门诊智能体                           │
│     │                      │                               │
│     │                      ▼                               │
│     │               医生查看对话                            │
│     │                      │                               │
│     ▼                      ▼                               │
│  执行医嘱  ◀────── 开具医嘱/处方                            │
│     │                      │                               │
│     │                      ▼                               │
│     └──────────────▶  医生每天查看完成情况（远程查房）        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 解决的问题

- 医生不知道患者今天有没有完成医嘱
- 异常情况发现不及时（血糖过高、漏服药等）
- 需要一个地方快速查看患者状态和处理问题

---

## 二、页面结构

### 2.1 路由和菜单位置

| 项目 | 值 |
|------|-----|
| **路由** | `/rounding` |
| **菜单名称** | 「远程查房」 |
| **菜单图标** | `VideoCameraOutlined` 或 `MonitorOutlined` |
| **位置** | 在「医嘱执行监督」旁边 |

### 2.2 页面关系

```
                    /rounding (主页)
                          │
                          │ 点击患者卡片
                          ▼
                    /rounding/:patientId (详情页)
```

---

## 三、主页 - 患者看板

### 3.1 布局

```
┌─────────────────────────────────────────────────────────────────┐
│  🔍 搜索患者  [只看异常 ▼]  [只看高风险 ▼]                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │ 👤 张三      │  │ 👤 李四      │  │ 👤 王五      │            │
│  │             │  │             │  │             │            │
│  │ 今日完成率   │  │ 今日完成率   │  │ 今日完成率   │            │
│  │ ████████░░  │  │ ██████████  │  │ ██░░░░░░░░  │            │
│  │    75%      │  │   100%      │  │    25%      │            │
│  │             │  │   ✅ 正常   │  │   🔴 异常   │            │
│  └─────────────┘  └─────────────┘  └─────────────┘            │
│                                                                  │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐            │
│  │ 👤 赵六      │  │ 👤 孙七      │  │ 👤 周八      │            │
│  │     ...     │  │     ...     │  │     ...     │            │
│  └─────────────┘  └─────────────┘  └─────────────┘            │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 患者卡片内容

| 元素 | 说明 |
|------|------|
| 头像 | 患者头像（默认占位图） |
| 姓名 | 患者昵称 |
| 今日完成率 | 进度条 + 百分比 |
| 状态标识 | 进度条颜色表示状态 |

### 3.3 排序和筛选

**排序规则**：有异常的卡片自动排前面

**筛选功能**：
- 只看异常（完成率<50% 或有数值异常）
- 只看高风险（AI评估或医生标记）

---

## 四、详情页 - 患者全景

### 4.1 布局结构

```
┌─────────────────────────────────────────────────────────────────┐
│  ◀ 返回                          患者详情                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 【顶部】患者信息 + 预警横幅                               │   │
│  │                                                           │   │
│  │  👤 张三  |  糖尿病患者  |  上次问诊: 2小时前             │   │
│  │                                                           │   │
│  │  ⚠️ 预警: 血糖异常 11.2mmol/L | 今日完成率 25%          │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                  │
│  ┌─────────────────────────────┬─────────────────────────────┐ │
│  │ 【左侧】最近对话              │  【右侧】医嘱列表          │ │
│  │                             │                             │ │
│  │ 👤 患者: 我今天血糖8点5       │  💊 早餐前胰岛素            │ │
│  │ 🤖 AI: 血糖8.5在正常范围...   │     08:00  ⏸️ 未完成       │ │
│  │                             │                             │ │
│  │ 👤 患者: 晚上有点头晕         │  📊 餐后血糖监测            │ │
│  │ 🤖 AI: 头晕可能和血压有关...   │     09:00  ✅ 7.8          │ │
│  │                             │                             │ │
│  │ [查看全部对话]               │  [添加医嘱]                │ │
│  └─────────────────────────────┴─────────────────────────────┘ │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 【底部】依从性趋势（近7天折线图）                         │   │
│  │                                                           │   │
│  │  100% ┤   ●────●────●                                    │   │
│  │   50% ┤ ●              ●────●                            │   │
│  │    0% └──────────────────────────────────                │   │
│  │        一  二  三  四  五  六  日                         │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 各区域详情

**顶部 - 患者信息 + 预警横幅**
- 患者头像、姓名、患者类型标签
- 上次问诊时间
- 异常预警横幅（有异常才显示）

**左侧 - 最近对话**
- 显示最近 3-5 条对话
- 患者/AI 消息区分样式
- 「查看全部对话」链接跳转到问诊记录

**右侧 - 医嘱列表**
- 今日医嘱任务列表
- 任务状态（待完成/已完成/已超时）
- 监测数值显示（如有）
- 「添加医嘱」按钮

**底部 - 依从性趋势**
- 近 7 天依从性折线图
- 平均完成率统计

---

## 五、异常判定规则

| 类型 | 判定条件 | 卡片颜色 |
|------|----------|----------|
| **红色异常** | 完成率<50% 或 有危急值 | 🔴 红色 |
| **黄色预警** | 完成率50-80% 或 有轻微异常 | 🟡 黄色 |
| **绿色正常** | 完成率≥80% 无异常 | 🟢 绿色 |

**异常来源**：
1. 依从性异常 - 任务完成率低
2. 数值异常 - 监测数据超出正常范围（如血糖>10）
3. 时间异常 - 超过提醒时间很久还没完成

---

## 六、数据来源

| 数据项 | 现有数据源 |
|--------|-----------|
| 患者列表 | `users` 表 + 关联的 `sessions` |
| 对话记录 | `sessions` + `messages` |
| 医嘱和任务 | `medical_orders` + `task_instances` |
| 依从性数据 | `compliance_service` |
| 预警数据 | `alerts` 表 |

---

## 七、技术实现要点

### 7.1 后端 API

复用现有 API，可能需要新增：

| API | 用途 |
|-----|------|
| `GET /rounding/patients` | 获取查房患者列表（含状态汇总） |
| `GET /rounding/patients/:id/overview` | 获取患者全景数据 |

### 7.2 前端组件

| 组件 | 路径 |
|------|------|
| `RoundingPage.tsx` | 患者看板主页 |
| `PatientCard.tsx` | 患者卡片组件 |
| `PatientDetailView.tsx` | 患者全景详情页 |

---

## 八、验收标准

- [ ] 主页显示所有患者卡片，异常患者排在前面
- [ ] 卡片进度条颜色正确反映患者状态
- [ ] 点击卡片进入详情页
- [ ] 详情页正确显示患者信息、对话、医嘱、依从性
- [ ] 预警信息准确显示
- [ ] 筛选功能正常工作

---

**文档结束**
