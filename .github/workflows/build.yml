# Home-Health Docker 镜像构建工作流
# 使用国内自托管 Runner，无需推送到外部镜像仓库

name: Build Docker Images

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  build:
    # 使用自托管 Runner（国内服务器）
    runs-on: self-hosted

    strategy:
      matrix:
        service: [backend, frontend]

    steps:
      - name: Checkout 代码
        uses: actions/checkout@v4

      - name: 构建镜像
        run: |
          echo "构建 ${{ matrix.service }} 镜像..."
          docker build -t home-health-${{ matrix.service }}:latest ./${{ matrix.service }}

      - name: 保存镜像（用于后续部署）
        run: |
          docker save home-health-${{ matrix.service }}:latest | \
            gzip > /tmp/home-health-${{ matrix.service }}.tar.gz

      - name: 输出镜像信息
        run: |
          echo "镜像已构建: home-health-${{ matrix.service }}:latest"
          docker images | grep home-health-${{ matrix.service }}
